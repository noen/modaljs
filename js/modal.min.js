
/**
 * Modal
 *
 * @copyright	Copyright (c) ecto.lt
 * @author		Benas Valanƒçius <benas@ecto.lt>
 * @url			https://ecto.lt
 * @version		0.1.2
 */

class Modal{obj;ol;timeout=150;omm=!1;opt={id:!1,title:"",html:"",width:!1,addClass:"",replace:!1,tplClose:'<button type="button" class="btn-close ui-modal-close"><i></i></button>',callback:!1,afterClose:!1};constructor(e){"string"==typeof e&&(e={html:e}),this.opt={...this.opt,...e},this.opt.id||(this.opt.id=`ui_modal_${this._randomId()}`),void 0===window.modalEscapeEventSet&&(document.addEventListener("keydown",e=>{"Escape"===e.key&&ModalClose()}),window.modalEscapeEventSet=1),this.open()}open(){void 0===window.global_zindex&&(window.global_zindex=2e3),window.global_zindex++,window.global_zindex++,this.opt.zindex=window.global_zindex;let e=`z-index:${this.opt.zindex};`;if(this.opt.width){let t=this.opt.width;-1===this.opt.width.toString().indexOf("%")&&-1===this.opt.width.toString().indexOf("em")&&-1===this.opt.width.toString().indexOf("rem")&&(t+="px"),e+=`--bs-modal-width:${t};`}let o=""===this.opt.title?`<div class="modal-header no-title">${this.opt.tplClose}</div>`:`<div class="modal-header row g-0 align-items-center"><div class="col"><div class="modal-title">${this.opt.title}</div></div><div class="col-auto">${this.opt.tplClose}</div></div>`,l=`<div class="modal ui-modal ${this.opt.addClass} fade" tabindex="-1" id="${this.opt.id}" style="${e}" aria-modal="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content">${o}<div class="modal-body"></div></div></div></div>`,d=document.getElementById(this.opt.id);if(d&&(d.id=`old_${d.id}`,d.dispatchEvent(new Event("modal.remove"))),document.body.insertAdjacentHTML("beforeend",l),this.obj=document.getElementById(this.opt.id),this.obj.addEventListener("modal.show",e=>{this.show()}),this.obj.addEventListener("modal.close",e=>{this.close()}),this.obj.addEventListener("modal.remove",e=>{this.remove()}),this.opt.replace){let i=document.querySelectorAll(".ui-modal.show");i.length>0&&i[i.length-1].dispatchEvent(new Event("modal.remove"))}setTimeout(e=>{let t=document.createRange().createContextualFragment(e.opt.html);e.obj.querySelector(".modal-body").append(t);let o=e.obj.querySelectorAll(".ui-modal-close");o&&o.forEach(t=>{t.addEventListener("click",t=>{e.close()})}),e.obj.dispatchEvent(new Event("modal.show")),"undefined"!=typeof project&&void 0!==project.cfg_modal_callback&&project.cfg_modal_callback(),e._call(e.opt.callback)},1,this)}overlay(){let e=this.opt.zindex-1,t=document.getElementById("ui-modal-overlay");t?t.style.zIndex=e:(t=`<div id="ui-modal-overlay" class="fade" style="z-index:${e}" />`,document.body.insertAdjacentHTML("beforeend",t),document.getElementById("ui-modal-overlay").classList.add("show"))}overlayHide(){let e=document.getElementById("ui-modal-overlay");e.classList.remove("show"),document.body.style.width="auto",document.body.classList.remove("overflow-hidden"),setTimeout(t=>{e.remove()},this.timeout,this)}show(){document.body.style.width=document.body.offsetWidth+"px",document.body.classList.add("overflow-hidden"),this.obj.classList.add("show"),this.overlay(),"undefined"!=typeof fw&&fw.loading.hide()}hide(){this.obj.classList.remove("show"),this.overlay()}remove(){this.obj.classList.add("overflow-hidden"),this.hide(),setTimeout(e=>{e.obj.remove(),e._call(e.opt.afterClose)},this.timeout,this)}close(){this.remove();let e=document.querySelectorAll(".ui-modal.show");if(e.length<1){this.overlayHide();return}let t=e[e.length-1];t.dispatchEvent(new Event("modal.show"))}_call(f){f&&("string"==typeof f?eval(f):f(this))}_randomId(){let e=6,t="abcdefghijklmnopqrstuvwxyz",o="",l;for(let d=0;d<e;d++)o+=t.charAt(l=Math.floor(Math.random()*t.length));return o}}function ModalClose(e){if(void 0===e){let t=document.querySelectorAll(".ui-modal.show");if(t.length<1)return;e=t[t.length-1]}e.classList.contains("ui-modal")||(e=e.closest(".ui-modal")),e.dispatchEvent(new Event("modal.close"))}