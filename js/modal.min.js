
/**
 * Modal
 *
 * @copyright	Copyright (c) ecto.lt
 * @author		Benas Valanƒçius <benas@ecto.lt>
 * @url			https://ecto.lt
 * @version		0.1.1
 */

class Modal{obj;ol;timeout=150;omm=!1;opt={id:!1,title:"",html:"",width:!1,addClass:"",replace:!1,tplClose:'<button type="button" class="btn-close ui-modal-close"><i></i></button>',callback:!1,afterClose:!1};constructor(t){"string"==typeof t&&(t={html:t}),this.opt={...this.opt,...t},this.opt.id||(this.opt.id=`ui_modal_${this._randomId()}`),void 0===window.modalEscapeEventSet&&(document.addEventListener("keydown",t=>{"Escape"===t.key&&ModalClose()}),window.modalEscapeEventSet=1),void 0!==this.opt.footer&&alert("footer"),this.open()}open(){void 0===window.global_zindex&&(window.global_zindex=2e3),window.global_zindex++,window.global_zindex++,this.opt.zindex=window.global_zindex;let t=`z-index:${this.opt.zindex};`;if(this.opt.width){let e=this.opt.width;-1===this.opt.width.toString().indexOf("%")&&-1===this.opt.width.toString().indexOf("em")&&-1===this.opt.width.toString().indexOf("rem")&&(e+="px"),t+=`--bs-modal-width:${e};`}let o=""===this.opt.title?`<div class="modal-header no-title">${this.opt.tplClose}</div>`:`<div class="modal-header row g-0 align-items-center"><div class="col"><div class="modal-title">${this.opt.title}</div></div><div class="col-auto">${this.opt.tplClose}</div></div>`,i=`<div class="modal ui-modal ${this.opt.addClass} fade" tabindex="-1" id="${this.opt.id}" style="${t}" aria-modal="true"><div class="modal-dialog modal-dialog-centered"><div class="modal-content">${o}<div class="modal-body">${this.opt.html}</div></div></div></div>`,l=document.getElementById(this.opt.id);l&&(l.id=`old_${l.id}`,l.dispatchEvent(new Event("modal.remove")));let d=document.createRange().createContextualFragment(i);document.body.append(d),this.obj=document.getElementById(this.opt.id);let s=this.obj.querySelectorAll(".ui-modal-close");if(s&&s.forEach(t=>{t.addEventListener("click",t=>{this.close()})}),this.obj.addEventListener("modal.show",t=>{this.show()}),this.obj.addEventListener("modal.close",t=>{this.close()}),this.obj.addEventListener("modal.remove",t=>{this.remove()}),this.opt.replace){let a=document.querySelectorAll(".ui-modal.show");a.length>0&&a[a.length-1].dispatchEvent(new Event("modal.remove"))}setTimeout(t=>{t.obj.dispatchEvent(new Event("modal.show")),"undefined"!=typeof project&&void 0!==project.cfg_modal_callback&&project.cfg_modal_callback(),this._call(t.opt.callback)},1,this)}overlay(){let t=this.opt.zindex-1,e=document.getElementById("ui-modal-overlay");e?e.style.zIndex=t:(e=`<div id="ui-modal-overlay" class="fade" style="z-index:${t}" />`,document.body.insertAdjacentHTML("beforeend",e),document.getElementById("ui-modal-overlay").classList.add("show"))}overlayHide(){let t=document.getElementById("ui-modal-overlay");t.classList.remove("show"),document.body.style.width="auto",document.body.classList.remove("overflow-hidden"),setTimeout(e=>{t.remove()},this.timeout,this)}show(){document.body.style.width=document.body.offsetWidth+"px",document.body.classList.add("overflow-hidden"),this.obj.classList.add("show"),this.overlay(),"undefined"!=typeof fw&&fw.loading.hide()}hide(){this.obj.classList.remove("show"),this.overlay()}remove(){this.obj.classList.add("overflow-hidden"),this.hide(),setTimeout(t=>{t.obj.remove(),t._call(t.opt.afterClose)},this.timeout,this)}close(){this.remove();let t=document.querySelectorAll(".ui-modal.show");if(t.length<1){this.overlayHide();return}let e=t[t.length-1];e.dispatchEvent(new Event("modal.show"))}_call(f){f&&("string"==typeof f?eval(f):f(this))}_randomId(){let t=6,e="abcdefghijklmnopqrstuvwxyz",o="",i;for(let l=0;l<t;l++)o+=e.charAt(i=Math.floor(Math.random()*e.length));return o}}function ModalClose(t){if(void 0===t){let e=document.querySelectorAll(".ui-modal.show");if(e.length<1)return;t=e[e.length-1]}t.classList.contains("ui-modal")||(t=t.closest(".ui-modal")),t.dispatchEvent(new Event("modal.close"))}